<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Tag Meta yang Diperlukan -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta property="og:title" content="Bucket Tangan Navirins" />
    <meta property="og:description" content="Apakah kamu mencari bucket tangan hias?" />
    <meta property="og:image" content="{{ url_for('static', filename='') }}" />

    <!-- Judul Halaman Web -->
    <title>Pembayaran</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../static/img/favicon.ico" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet" />

    <!-- CSS Files -->
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />

</head>

<body>

    <!-- Header -->
    {% if user_info %}
    {% if user_info.role == 'admin' %}
    {% include 'user/navbar/navbar_admin.html' %}
    {% elif user_info.role == 'member' %}
    {% include 'user/navbar/navbar_member.html' %}
    {% endif %}
    {% else %}
    {% include 'user/navbar/navbar_visitor.html' %}
    {% endif %}

    <main id="main" class="py-5">
        <div class="container py-5 d-flex justify-content-center">
            <div class="container mt-5" data-aos="fade-down">
                <div class="section-title">
                    <h2>Pembayaran</h2>
                    <p>Form Pembayaran</p>
                </div>
                <hr class="mb-5">
                <form method="POST" action="{{ url_for('submit_purchase') }}" enctype="multipart/form-data">
                    <input type="hidden" name="order_id" value="{{ order._id }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="bucket_name" class="form-label">Nama Buket</label>
                            <input type="text" class="form-control" id="bucket_name" value="{{ order.bucket_name }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="quantity" class="form-label">Kuantitas</label>
                            <input type="number" class="form-control" id="quantity" value="{{ order.quantity }}" readonly>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="total_price" class="form-label">Total Harga</label>
                            <input type="text" class="form-control" id="total_price" value="Rp {{ order.total_price }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="name" value="{{ order.name }}" readonly>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" value="{{ order.useremail }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">No Telepon</label>
                            <input type="text" class="form-control" id="phone" value="{{ order.phone }}" readonly>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">Alamat</label>
                        <textarea class="form-control" id="address" rows="3" readonly>{{ order.address }}</textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="shippingMethod" class="form-label">Metode Pengiriman</label>
                            <select class="form-select" id="shippingMethod" name="shippingMethod" required>
                                <option value="kurir">Kurir</option>
                                <option value="ojek_online">Ojek Online</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="paymentMethod" class="form-label">Pembayaran</label>
                            <div id="paymentMethod">
                                <img src="/static/img/qris-image.png" alt="QRIS" style="width: 100%; max-width: 200px;" />
                            </div>
                        </div>
                        
                    </div>
                    <div class="mb-3">
                        <label for="paymentProof" class="form-label">Upload Bukti Pembayaran</label>
                        <input type="file" class="form-control" id="paymentProof" name="paymentProof" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <button type="submit" class="form-control btn btn-outline-success">Bayar</button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="/koleksi" class="form-control btn btn-outline-dark">Batal</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    {% include 'user/footer/footer.html' %}

    <!-- JS Files -->
    <script src="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isotope-layout@3.0.6/dist/isotope.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vef91dfe02fce4ee0ad053f6de4f175db1715022073587" integrity="sha512-sDIX0kl85v1Cl5tu4WGLZCpH/dV9OHbA4YlKCuCiMmOQIk4buzoYDZSFj+TvC71mOBLh8CDC/REgE0GX0xcbjA==" data-cf-beacon='{"rayId":"888acaedeb29797c","version":"2024.4.1","token":"68c5ca450bae485a842ff76066d69420"}' crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            // Submit form pembayaran
            $('form').submit(function(event) {
                event.preventDefault(); // Mencegah form dari pengiriman standar
                var formData = new FormData($(this)[0]);
    
                $.ajax({
                    url: "{{ url_for('submit_purchase') }}",
                    type: 'POST',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        // Tampilkan SweetAlert ketika pembayaran berhasil
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer);
                                toast.addEventListener('mouseleave', Swal.resumeTimer);
                            }
                        });
    
                        Toast.fire({
                            icon: 'success',
                            title: response.message
                        });
    
                        // Arahkan ke halaman profil setelah 3 detik
                        setTimeout(function() {
                            window.location.href = '/koleksi';
                        }, 3000);
                    },
                    error: function(xhr, status, error) {
                        // Tangani kesalahan jika ada
                        console.error(xhr.responseText);
                    }
                });
            });
        });
    </script>
    
