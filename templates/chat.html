<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Tag meta yang diperlukan -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta property="og:title" content="Bucket Tangan Navirins" />
    <meta property="og:description" content="Apakah kamu mencari bucket tangan hias?" />
    <meta property="og:image" content="{{ url_for('static', filename='') }}" />

    <!-- Judul halaman web -->
    <title>Obrolan</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../static/img/favicon.ico" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/2.0.2/quill.snow.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/2.0.2/quill.bubble.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css" rel="stylesheet" />
    <link href="../static/css/style_lama.css" rel="stylesheet" />
</head>

<body>
    <!-- Header -->
    <header id="header" class="header fixed-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-between">
            <a href="/" class="logo d-flex align-items-center">
                <img src="../static/img/navirins.png" alt="" style="margin-left: 9px;">
                <span class="d-lg-block">Navirin's</span>
            </a>
        </div>
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img src="{{ url_for('static', filename=user_info.profile_pic_real) }}" alt="Profile" class="rounded-circle">
                        <span class="d-none d-md-block dropdown-toggle ps-2">{{ user_info.profile_name }}</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="/profil/{{ user_info.account_name }}">
                                <i class="bi bi-person-vcard"></i>
                                <span>Profil</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="/obrolan/{{ user_info.account_name }}">
                                <i class="bi bi-chat-left-dots"></i>
                                <span>Obrolan</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="/histori-pembayaran/{{ user_info.account_name }}">
                                <i class="bi bi-credit-card"></i>
                                <span>Histori Pembayaran</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="/status-pengiriman/{{ user_info.account_name }}">
                                <i class="bi bi-car-front"></i>
                                <span>Status Pengiriman</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#" onclick="return logout();">
                                <i class="bi bi-box-arrow-right"></i>
                                <span>Keluar</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <main id="main" class="main">
        <section class="section contact">
            <div class="row gy-4">
                <div class="col-xl-6">
                    <div class="card p-4">
                        <div class="card-body">
                            <h5 class="card-title">Example Card</h5>
                            <p>This is an examle page with no contrnt. You can use it as a starter for your custom pages.</p>
                        </div>
                        <form action="/memasukkan-obrolan" method="POST" class="php-email-form">
                            <div class="row gy-4">
                                <div class="col-md-12">
                                    <textarea class="form-control" name="message" id="message" rows="6" placeholder="Message" required></textarea>
                                </div>
                                <div class="col-md-12 text-center">
                                    <div class="loading">Loading</div>
                                    <div class="error-message"></div>
                                    <div class="sent-message">Your message has been sent. Thank you!</div>
                                    <button type="submit">Send Message</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="info-box card">
                                <i class="bi bi-geo-alt"></i>
                                <h3>Address</h3>
                                <p>A108 Adam Street,<br>New York, NY 535022</p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="info-box card">
                                <i class="bi bi-telephone"></i>
                                <h3>Call Us</h3>
                                <p>+1 5589 55488 55<br>+1 6678 254445 41</p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="info-box card">
                                <i class="bi bi-envelope"></i>
                                <h3>Email Us</h3>
                                <p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b52555d547b5e435a564b575e15585456">[email&#160;protected]</a><br><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9af9f5f4eefbf9eedaffe2fbf7eaf6ffb4f9f5f7">[email&#160;protected]</a></p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="info-box card">
                                <i class="bi bi-clock"></i>
                                <h3>Open Hours</h3>
                                <p>Monday - Friday<br>9:00AM - 05:00PM</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="footer" class="footer">
        <div class="copyright">
            <a href="https://www.instagram.com/navirins/"><i class="bi bi-instagram"> @navirins</i></a>
        </div>
        <div class="credits">
            &copy; Hak Cipta <strong><span>Navirins</span></strong>. Dirancang oleh Tim Navirins
        </div>
    </footer>

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.49.1/dist/apexcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/2.0.2/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tinymce@7.1.1/tinymce.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://static.cloudflareinsights.com/beacon.min.js/vef91dfe02fce4ee0ad053f6de4f175db1715022073587" defer></script>
    <script src="../static/js/main_lama.js"></script>
    <script>
        $(document).keypress(function (event) {
            if (event.key === 'Enter') {
                chat();
            }
        })

        function post() {
            let comment = $('#textarea-post').val();
            let today = new Date().toISOString();
            $.ajax({
                type: 'POST',
                url: '/posting',
                data: {
                    comment_give: comment,
                    date_give: today
                },
                success: function (response) {
                    $('#modal-post').removeClass('is-active');
                    window.location.reload();
                },
            });
        }

        function time2str(date) {
            let today = new Date();
            let time = (today - date) / 1000 / 60;  // minutes

            if (time < 60) {
                return parseInt(time) + " minutes ago";
            }
            time = time / 60;   // hours
            if (time < 24) {
                return parseInt(time) + " hours ago";
            }
            time = time / 24;   // days
            if (time < 7) {
                return parseInt(time) + " days ago";
            }
            return `${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()}`;
        }

        function num2str(count) {
            if (count > 10000) {
                return parseInt(count / 1000) + 'k';
            }
            if (count > 500) {
                return parseInt(count / 100) / 10 + 'k';
            }
            if (count == 0) {
                return '';
            }
            return count;
        }

        function get_posts(username) {
            if (username == undefined) {
                username = '';
            }
            $('#post-box').empty();
            $.ajax({
                type: 'GET',
                url: `/get_posts?username_give=${username}`,
                data: {},
                success: function (response) {
                    if (response['result'] === 'success') {
                        let posts = response['posts'];
                        for (let i = 0; i < posts.length; i++) {
                            let post = posts[i];
                            let time_post = new Date(post['date']);
                            let time_before = time2str(time_post);
                            // let class_heart = '';
                            // if (post['heart_by_me']) {
                            //     class_heart = 'fa-heart';
                            // } else {
                            //     class_heart = 'fa-heart-o';
                            // }
                            // atau
                            // variable = condition ? value if true : value if false
                            let class_heart = post['heart_by_me'] ? 'fa-heart': 'fa-heart-o';
                            let class_star = post['star_by_me'] ? 'fa-star': 'fa-star-o';
                            let class_thumbsup = post['thumbsup_by_me'] ? 'fa-thumbs-up': 'fa-thumbs-o-up';
                            let html_temp = `
                                <div class="box" id="${post['_id']}">
                                    <article class="media">
                                        <div class="media-left">
                                            <a class="image is-64x64" href="/user/${post['username']}">
                                                <img class="is-rounded" src="/static/${post['profile_pic_real']}" alt="Image"/>
                                            </a>
                                        </div>
                                        <div class="media-content">
                                            <div class="content">
                                                <p>
                                                    <strong>${post['profile_name']}</strong> <small>@${post['username']}</small>
                                                    <small>${time_before}</small>
                                                    <br/>
                                                    ${post['comment']}
                                                </p>
                                            </div>
                                            <nav class="level is-mobile">
                                                <div class="level-left">
                                                    <a
                                                        class="level-item is-sparta"
                                                        aria-label="heart"
                                                        onclick="toggle_like('${post['_id']}', 'heart')"
                                                    >
                                                    <span class="icon is-small">
                                                        <i class="fa ${class_heart}" area-hidden="true"></i>
                                                    </span>
                                                    &nbsp;
                                                    <span class="like-num">${num2str(post['count_heart'])}</span>
                                                    </a>

                                                    <a
                                                        class="level-item is-sparta"
                                                        aria-label="star"
                                                        onclick="toggle_star('${post['_id']}', 'star')"
                                                    >
                                                    <span class="icon is-small">
                                                        <i class="fa ${class_star}" area-hidden="true"></i>
                                                    </span>
                                                    &nbsp;
                                                    <span class="like-num">${num2str(post['count_star'])}</span>
                                                    </a>

                                                    <a
                                                        class="level-item is-sparta"
                                                        aria-label="thumbsup"
                                                        onclick="toggle_thumbsup('${post['_id']}', 'thumbsup')"
                                                    >
                                                    <span class="icon is-small">
                                                        <i class="fa ${class_thumbsup}" area-hidden="true"></i>
                                                    </span>
                                                    &nbsp;
                                                    <span class="like-num">${num2str(post['count_thumbsup'])}</span>
                                                    </a>
                                                </div>
                                            </nav>
                                        </div>
                                    </article>
                                </div>
                            `;
                            $('#post-box').append(html_temp);
                        }
                    }
                },
            });
        }

        function chat() {
            let message = $('#message').val();

            $.ajax({
                type: 'POST',
                url: '/memasukkan-obrolan',
                data: {
                    message_give: message
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.onmouseenter = Swal.stopTimer;
                                toast.onmouseleave = Swal.resumeTimer;
                            }
                        });
                        Toast.fire({
                            icon: 'success',
                            title: 'Kirim obrolan sukses'
                        });
                        setTimeout(function () {
                            window.location.href = '/';
                        }, 3000);
                    }
                }
            })
        }

        function logout() {
            $.removeCookie('bouquet', { path: '/' })
            Swal.fire({
                title: "Keluar",
                text: "Apakah Anda yakin ingin keluar dari website ini?",
                icon: "warning",
                showClass: {
                    popup: `
                        animate__animated
                        animate__fadeInDown
                    `
                },
                showCloseButton: true,
                showCancelButton: true,
                confirmButtonText: "Yakin",
                cancelButtonText: "Batal",
                hideClass: {
                    popup: `
                        animate__animated
                        animate__fadeOut
                    `
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.onmouseenter = Swal.stopTimer;
                            toast.onmouseleave = Swal.resumeTimer;
                        },
                        showClass: {
                            popup: `
                                animate__animated
                                animate__zoomIn
                            `
                        }
                    });
                    Toast.fire({
                        icon: 'success',
                        title: 'Berhasil keluar'
                    });
                    setTimeout(function () {
                        window.location.href = '/';
                    }, 3000);
                }
            });
        }
    </script>
</body>

</html>